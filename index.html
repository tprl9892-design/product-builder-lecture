<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>LottoMind-AI | FUTURE HUD</title>
  <style>
    :root{
      --bg:#05070f;
      --fg:#eaf0ff;
      --muted:#a7b7da;
      --line:rgba(255,255,255,0.12);
      --glass:rgba(255,255,255,0.06);
      --glass2:rgba(255,255,255,0.03);
      --neon:#46f3ff;
      --neon2:#8b5cff;
      --hot:#ff5bd6;
      --ok:#3dff9b;
      --pill-bg: rgba(0,0,0,0.25);
      --input-bg:#0b1020;
      --panel-shadow: rgba(0,0,0,0.55);
      --bg-grad-1: radial-gradient(1200px 800px at 18% 0%, rgba(70,243,255,0.14), transparent 60%);
      --bg-grad-2: radial-gradient(1000px 700px at 85% 18%, rgba(139,92,255,0.18), transparent 60%);
      --bg-grad-3: radial-gradient(900px 700px at 40% 90%, rgba(255,91,214,0.10), transparent 60%);
    }
    :root[data-theme="light"]{
      --bg:#f3f6ff;
      --fg:#0b1020;
      --muted:#4c5c7a;
      --line:rgba(11,16,32,0.12);
      --glass:rgba(255,255,255,0.75);
      --glass2:rgba(255,255,255,0.45);
      --pill-bg: rgba(255,255,255,0.85);
      --input-bg:#f6f8ff;
      --panel-shadow: rgba(7,12,24,0.18);
      --bg-grad-1: radial-gradient(1200px 800px at 18% 0%, rgba(70,243,255,0.12), transparent 60%);
      --bg-grad-2: radial-gradient(1000px 700px at 85% 18%, rgba(139,92,255,0.10), transparent 60%);
      --bg-grad-3: radial-gradient(900px 700px at 40% 90%, rgba(255,91,214,0.08), transparent 60%);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      color:var(--fg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;
      background:
        var(--bg-grad-1),
        var(--bg-grad-2),
        var(--bg-grad-3),
        var(--bg);
      overflow-x:hidden;
    }

    /* Animated stars canvas sits behind everything */
    #bgFx{
      position:fixed; inset:0;
      z-index:-1;
      width:100%; height:100%;
    }

    .wrap{max-width:1180px;margin:0 auto;padding:22px 18px 40px;}
    .top{
      display:flex; gap:16px; flex-wrap:wrap; align-items:stretch;
    }
    .panel{
      flex:1; min-width:320px;
      border-radius:22px;
      border:1px solid var(--line);
      background:linear-gradient(180deg, var(--glass), var(--glass2));
      box-shadow: 0 22px 80px var(--panel-shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
      position:relative;
    }
    .panel::before{
      content:"";
      position:absolute; inset:-2px;
      background: linear-gradient(120deg, rgba(70,243,255,0.35), rgba(139,92,255,0.20), rgba(255,91,214,0.16));
      filter: blur(18px);
      opacity: .45;
      pointer-events:none;
    }
    .panelHead{
      padding:16px 16px 0;
      position:relative;
      z-index:1;
    }
    .brandRow{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(70,243,255,0.20);
      background: rgba(70,243,255,0.06);
      font-size:12px; color:var(--fg);
      box-shadow: 0 0 0 1px rgba(139,92,255,0.10) inset;
    }
    .dot{
      width:9px;height:9px;border-radius:50%;
      background:var(--neon);
      box-shadow: 0 0 18px rgba(70,243,255,0.95);
      animation:pulseDot 1.3s infinite;
    }
    @keyframes pulseDot{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.25);opacity:.75}}

    h1{
      margin:10px 0 6px;
      font-size:20px;
      letter-spacing:0.2px;
    }
    .desc{
      margin:0 0 12px;
      color:var(--muted);
      font-size:13px; line-height:1.6;
    }
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

    .controls{
      display:flex; gap:10px; flex-wrap:wrap;
      padding:0 16px 16px;
      position:relative;
      z-index:1;
    }
    .pill{
      display:flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.12);
      background: var(--pill-bg);
      color:var(--muted);
      font-size:12px;
    }
    .pill.themeBtn{
      border:1px solid var(--line);
      color:var(--fg);
      cursor:pointer;
      appearance:none;
    }
    .pill.themeBtn:hover{ filter:brightness(1.06); }
    select{
      background:var(--input-bg); color:var(--fg);
      border:1px solid rgba(255,255,255,0.18);
      border-radius:12px;
      padding:10px 10px;
      outline:none;
    }
    .formField{
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-bottom:12px;
    }
    .formField label{
      font-size:12px;
      color:var(--muted);
    }
    .formField input,
    .formField textarea{
      background:var(--input-bg);
      color:var(--fg);
      border:1px solid rgba(255,255,255,0.18);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
      font-size:13px;
    }
    .formField textarea{ min-height:110px; resize:vertical; }
    .formBtn{
      width:100%;
      border:1px solid rgba(255,255,255,0.16);
      border-radius:12px;
      padding:12px 14px;
      color:var(--fg);
      background:linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02));
      cursor:pointer;
      font-weight:700;
    }
    .formBtn:hover{ filter:brightness(1.05); }
    .commentList{
      margin-top:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .commentItem{
      border:1px solid rgba(255,255,255,0.10);
      border-radius:12px;
      padding:10px 12px;
      background:rgba(255,255,255,0.03);
    }
    .commentMeta{
      display:flex;
      justify-content:space-between;
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }
    .commentBody{ font-size:13px; color:var(--fg); line-height:1.4; }

    /* ===== MEGA BUTTON (energy burst) ===== */
    .megaBtn{
      flex:1;
      min-width:280px;
      position:relative;
      border:0;
      border-radius:18px;
      padding:16px 16px;
      cursor:pointer;
      color:var(--fg);
      font-weight:900;
      letter-spacing:0.6px;
      text-transform:uppercase;
      background:
        radial-gradient(120px 80px at 25% 30%, rgba(70,243,255,0.35), transparent 60%),
        radial-gradient(140px 100px at 80% 40%, rgba(139,92,255,0.28), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.16);
      box-shadow:
        0 18px 60px rgba(0,0,0,0.55),
        0 0 0 1px rgba(70,243,255,0.14) inset,
        0 0 40px rgba(70,243,255,0.12);
      overflow:hidden;
      transform: translateZ(0);
    }
    .megaBtn .sub{
      display:block;
      margin-top:6px;
      font-size:12px;
      color:rgba(234,240,255,0.82);
      font-weight:600;
      text-transform:none;
      letter-spacing:0;
    }
    .megaBtn::before{
      content:"";
      position:absolute; inset:-2px;
      background: conic-gradient(from 180deg, rgba(70,243,255,0.0), rgba(70,243,255,0.35), rgba(139,92,255,0.25), rgba(255,91,214,0.22), rgba(70,243,255,0.0));
      filter: blur(10px);
      opacity:.55;
      animation: spinGlow 3.2s linear infinite;
    }
    @keyframes spinGlow { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
    .megaBtn::after{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(90deg, transparent, rgba(255,255,255,0.14), transparent);
      transform: translateX(-140%);
      transition: transform .45s ease;
      opacity:.65;
      pointer-events:none;
    }
    .megaBtn:hover::after{ transform: translateX(140%); }
    .megaBtn:active{ transform: scale(0.985); }
    .megaBtn[disabled]{ opacity:.55; cursor:not-allowed; filter:saturate(.75); }

    /* Energy sparks on button press */
    .spark{
      position:absolute;
      width:10px; height:10px;
      border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,0) 60%),
                  radial-gradient(circle at 50% 50%, rgba(70,243,255,1), rgba(70,243,255,0) 70%);
      box-shadow: 0 0 18px rgba(70,243,255,0.9), 0 0 24px rgba(139,92,255,0.6);
      pointer-events:none;
      animation: sparkFly .7s ease-out forwards;
    }
    @keyframes sparkFly{
      to{
        transform: translate(var(--dx), var(--dy)) scale(0.2);
        opacity:0;
      }
    }

    /* ===== layout cards ===== */
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px;margin-top:14px}
    .card{
      grid-column:span 12;
      border-radius:20px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(12,16,28,0.72);
      backdrop-filter: blur(12px);
      padding:14px;
      box-shadow: 0 16px 60px rgba(0,0,0,0.40);
    }
    @media (min-width:980px){
      .c6{grid-column:span 6}
      .c4{grid-column:span 4}
    }
    .card h2{margin:0 0 10px;font-size:14px; letter-spacing:.2px;}
    .chips{display:flex;flex-wrap:wrap;gap:7px}
    .chip{
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
      font-size:12px;
      box-shadow: 0 0 0 1px rgba(70,243,255,0.06) inset;
    }
    .muted{color:var(--muted);font-size:12px}
    .log{
      height:210px; overflow:auto; white-space:pre-wrap;
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.28);
      color:#d5e4ff;
      font-size:12px; line-height:1.55;
    }
    .nums{display:flex;flex-wrap:wrap;gap:7px; margin-top:8px}
    .ball{
      width:36px; height:36px;
      border-radius:50%;
      display:grid; place-items:center;
      font-weight:900;
      background: linear-gradient(180deg, rgba(31,60,255,0.95), rgba(10,26,68,0.92));
      border:1px solid rgba(255,255,255,0.18);
      box-shadow: 0 10px 26px rgba(70,243,255,0.10), 0 0 0 1px rgba(70,243,255,0.10) inset;
    }
    .kpiRow{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;
    }
    .kpi{
      padding:8px 10px;
      border-radius:14px;
      border:1px solid rgba(70,243,255,0.22);
      background: rgba(70,243,255,0.06);
      font-size:12px;
      display:flex; align-items:center; gap:8px;
    }
    .kpi b{color:rgba(234,240,255,0.92)}
    .kpi .miniDot{width:8px;height:8px;border-radius:50%;background:var(--ok);box-shadow:0 0 16px rgba(61,255,155,0.75)}

    /* ===== HUD Overlay (robot compute) ===== */
    .hud.hidden{ display:none; }
    .hud{
      position:fixed; inset:0; z-index:9999;
      display:grid; place-items:center;
    }
    .hudBg{
      position:absolute; inset:0;
      background:
        radial-gradient(1000px 700px at 20% 15%, rgba(70,243,255,0.12), transparent 60%),
        radial-gradient(1000px 700px at 85% 25%, rgba(139,92,255,0.14), transparent 60%),
        rgba(2,4,12,0.86);
      backdrop-filter: blur(12px);
    }
    .hudFrame{
      position:relative;
      width:min(980px, 92vw);
      border-radius:24px;
      border:1px solid rgba(255,255,255,0.14);
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.03));
      box-shadow: 0 40px 120px rgba(0,0,0,0.65);
      overflow:hidden;
    }
    .hudFrame::before{
      content:"";
      position:absolute; inset:-3px;
      background: linear-gradient(120deg, rgba(70,243,255,0.35), rgba(139,92,255,0.24), rgba(255,91,214,0.18));
      filter: blur(18px);
      opacity:.55;
      pointer-events:none;
    }
    .hudFrame::after{
      content:"";
      position:absolute; inset:0;
      background: repeating-linear-gradient(0deg, rgba(255,255,255,0.05), rgba(255,255,255,0.05) 1px, transparent 1px, transparent 5px);
      opacity:.10;
      pointer-events:none;
    }
    .hudTop{
      position:relative; z-index:1;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,0.10);
    }
    .hudTitle{display:flex; gap:10px; align-items:center}
    .hudTitle .dot{width:10px;height:10px;border-radius:50%;background:var(--neon);box-shadow:0 0 20px rgba(70,243,255,0.9)}
    .hudClose{
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      border-radius:14px;
      padding:8px 10px;
      cursor:pointer;
      color:var(--fg);
    }
    .hudBody{
      position:relative; z-index:1;
      display:grid;
      grid-template-columns: 340px 1fr;
      gap:14px;
      padding:16px;
    }
    @media (max-width:900px){
      .hudBody{ grid-template-columns:1fr; }
    }
    .hudLeft{display:flex; flex-direction:column; gap:14px}
    .hudRight{display:flex; flex-direction:column; gap:12px}
    .hudConsole{
      height:280px;
      overflow:auto;
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(70,243,255,0.20);
      background: rgba(0,0,0,0.34);
      color:#d6e6ff;
      white-space:pre-wrap;
      line-height:1.55;
    }
    .hudMini{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    .miniCard{
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
      padding:10px;
    }
    .miniTitle{color:var(--muted);font-size:12px}
    .miniValue{margin-top:6px;font-weight:900;text-shadow:0 0 18px rgba(70,243,255,0.25)}
    .hudMeter{
      border-radius:20px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
      padding:12px;
    }
    .meterLabel{display:flex; justify-content:space-between; font-size:12px; color:#cfe0ff}
    .meterTrack{
      margin-top:10px;
      height:12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.35);
      overflow:hidden;
    }
    .meterBar{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(70,243,255,0.95), rgba(139,92,255,0.95), rgba(255,91,214,0.75));
      box-shadow: 0 0 26px rgba(70,243,255,0.35);
      transition: width .12s linear;
    }
    .meterSub{margin-top:10px; font-size:12px; color:var(--muted)}
    .hudBottom{
      position:relative; z-index:1;
      padding:12px 16px;
      border-top:1px solid rgba(255,255,255,0.10);
      display:flex; justify-content:space-between; gap:10px;
      color:#d3e3ff;
    }
    .glow{text-shadow:0 0 20px rgba(70,243,255,0.35)}

    /* CSS Robot */
    .robot{
      position:relative;
      width:260px; height:260px;
      margin:0 auto;
      filter: drop-shadow(0 20px 40px rgba(0,0,0,0.55));
    }
    .antenna{
      position:absolute; left:50%; top:8px; transform:translateX(-50%);
      width:6px; height:46px; border-radius:99px;
      background: linear-gradient(180deg, rgba(70,243,255,0.9), rgba(70,243,255,0.05));
    }
    .antenna::after{
      content:""; position:absolute; left:50%; top:-10px; transform:translateX(-50%);
      width:16px;height:16px;border-radius:50%;
      background:var(--neon);
      box-shadow:0 0 24px rgba(70,243,255,0.95);
      animation: pulseA 1.1s infinite;
    }
    @keyframes pulseA{0%,100%{transform:translateX(-50%) scale(1);opacity:1}50%{transform:translateX(-50%) scale(1.12);opacity:.8}}

    .head{
      position:absolute; left:50%; top:46px; transform:translateX(-50%);
      width:220px; height:122px; border-radius:22px;
      border:1px solid rgba(255,255,255,0.16);
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04));
      overflow:hidden;
    }
    .visor{
      position:absolute; left:14px; right:14px; top:16px; height:56px;
      border-radius:18px;
      background: linear-gradient(90deg, rgba(70,243,255,0.18), rgba(139,92,255,0.12));
      border:1px solid rgba(70,243,255,0.28);
      overflow:hidden;
    }
    .scanline{
      position:absolute; left:0; right:0;
      height:22px;
      background: linear-gradient(180deg, transparent, rgba(70,243,255,0.38), transparent);
      animation: scan 1.15s linear infinite;
    }
    @keyframes scan{0%{top:-28px}100%{top:88px}}
    .eyes{
      position:absolute; left:0; right:0; bottom:14px;
      display:flex; justify-content:center; gap:10px;
    }
    .eyes span{
      width:10px;height:10px;border-radius:50%;
      background: rgba(70,243,255,0.95);
      box-shadow: 0 0 16px rgba(70,243,255,0.85);
      animation: blink 2.2s infinite;
    }
    .eyes span:nth-child(2){ animation-delay:.2s; background: rgba(139,92,255,0.92); }
    .eyes span:nth-child(3){ animation-delay:.4s; background: rgba(255,91,214,0.82); }
    @keyframes blink{0%,92%,100%{transform:scale(1)}94%{transform:scale(0.25)}96%{transform:scale(1)}}

    .neck{
      position:absolute; left:50%; top:170px; transform:translateX(-50%);
      width:46px; height:18px; border-radius:10px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.05);
    }
    .torso{
      position:absolute; left:50%; top:188px; transform:translateX(-50%);
      width:240px; height:88px; border-radius:24px;
      border:1px solid rgba(255,255,255,0.16);
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.03));
    }
    .core{
      position:absolute; left:50%; top:20px; transform:translateX(-50%);
      width:46px; height:46px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, rgba(70,243,255,1), rgba(139,92,255,0.65), rgba(255,91,214,0.25), rgba(0,0,0,0));
      box-shadow: 0 0 30px rgba(70,243,255,0.35);
      animation: corePulse 1.1s infinite;
    }
    @keyframes corePulse{0%,100%{transform:translateX(-50%) scale(1)}50%{transform:translateX(-50%) scale(1.08)}}
    .bars{
      position:absolute; right:16px; top:18px;
      display:flex; gap:6px; align-items:flex-end;
    }
    .bars i{
      display:block;
      width:6px; height:18px;
      border-radius:999px;
      background: rgba(70,243,255,0.62);
      animation: eq .8s infinite;
    }
    .bars i:nth-child(2){height:26px; animation-delay:.1s; background: rgba(139,92,255,0.62)}
    .bars i:nth-child(3){height:14px; animation-delay:.2s}
    .bars i:nth-child(4){height:30px; animation-delay:.3s; background: rgba(255,91,214,0.52)}
    .bars i:nth-child(5){height:20px; animation-delay:.4s}
    @keyframes eq{0%,100%{transform:scaleY(.7);opacity:.7}50%{transform:scaleY(1.25);opacity:1}}

    .arms .arm{
      position:absolute; top:204px;
      width:54px; height:64px; border-radius:18px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
      display:flex; flex-direction:column; justify-content:center; gap:8px;
      padding:10px;
    }
    .arms .left{ left:-8px; transform:rotate(-8deg); }
    .arms .right{ right:-8px; transform:rotate(8deg); }
    .arms b{
      display:block; height:8px; border-radius:999px;
      background: linear-gradient(90deg, rgba(70,243,255,0.55), rgba(139,92,255,0.45), rgba(255,91,214,0.40));
      animation: shimmer 1.1s infinite;
    }
    @keyframes shimmer{0%,100%{filter:brightness(1)}50%{filter:brightness(1.35)}}

    /* subtle shake on compute */
    .shake{
      animation: shake .45s ease-in-out;
    }
    @keyframes shake{
      0%,100%{transform:translate(0,0)}
      20%{transform:translate(-2px,1px)}
      40%{transform:translate(3px,-2px)}
      60%{transform:translate(-3px,2px)}
      80%{transform:translate(2px,-1px)}
    }

    /* Light mode refinements */
    :root[data-theme="light"] .card{
      background: rgba(255,255,255,0.78);
      box-shadow: 0 16px 50px rgba(7,12,24,0.18);
    }
    :root[data-theme="light"] .log,
    :root[data-theme="light"] .hudConsole{
      background: rgba(255,255,255,0.80);
      color:#1a243a;
      border-color: var(--line);
    }
    :root[data-theme="light"] .chip{
      background: rgba(11,16,32,0.04);
    }
    :root[data-theme="light"] .panel::before{
      opacity:.28;
    }
    :root[data-theme="light"] .hudBg{
      background:
        radial-gradient(1000px 700px at 20% 15%, rgba(70,243,255,0.10), transparent 60%),
        radial-gradient(1000px 700px at 85% 25%, rgba(139,92,255,0.10), transparent 60%),
        rgba(245,248,255,0.88);
    }

    a{color:inherit}
  </style>
</head>

<body>
<canvas id="bgFx"></canvas>

<div class="wrap">
  <div class="top">
    <div class="panel">
      <div class="panelHead">
        <div class="brandRow">
          <span class="badge"><span class="dot"></span><span class="mono">LOTTOCORE v1.0</span></span>
          <span class="badge"><span class="mono">AUTO-LATEST via PROXY</span></span>
          <button id="themeToggle" class="pill themeBtn" type="button" aria-pressed="false">í…Œë§ˆ ì „í™˜</button>
        </div>
        <h1>ğŸ¤– LottoMind-AI Â· ë¯¸ë˜í˜• ë¡œë˜ ë¶„ì„ & ìƒì„± ì‹œìŠ¤í…œ</h1>
        <p class="desc">
          ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ <b>ë¡œë´‡ HUDê°€ í­ë°œì ìœ¼ë¡œ ê³„ì‚°</b>í•˜ê³  <b>Hot/Cold/Overdue</b> + <b>ì—°ì†/êµ¬ê°„ íŒ¨í„´</b> ë¶„ì„ â†’
          <b>1~5ì¤„ ë²ˆí˜¸</b>ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.
          <br><span class="mono muted">â€» ë„¤íŠ¸ì›Œí¬ ìˆ˜ì§‘ ì—†ì´ ì¦‰ì‹œ ë¶„ì„ ì—°ì¶œ</span>
        </p>
        <div class="kpiRow" id="kpiRow"></div>
      </div>

      <div class="controls">
        <div class="pill">
          <span class="muted">ìƒì„± ì¤„ ìˆ˜</span>
          <select id="lineCount">
            <option value="1">1ì¤„</option>
            <option value="2">2ì¤„</option>
            <option value="3">3ì¤„</option>
            <option value="4">4ì¤„</option>
            <option value="5" selected>5ì¤„</option>
          </select>
        </div>

        <button id="btnGenerate" class="megaBtn" type="button">
          RUN AI ANALYSIS
          <span class="sub">ë¡œë´‡ HUD ê³„ì‚° í›„ ì¶”ì²œ ë²ˆí˜¸ ì¶œë ¥</span>
        </button>
      </div>
    </div>

    <div class="panel" style="max-width:420px;min-width:320px;">
      <div class="panelHead">
        <div class="brandRow">
          <span class="badge"><span class="dot"></span><span class="mono">ROBOT LOG</span></span>
        </div>
        <h1 style="margin-top:10px;">ğŸ§  ì‹¤ì‹œê°„ ê³„ì‚° ë¡œê·¸</h1>
        <p class="desc">ìˆ˜ì§‘/ë¶„ì„/ìƒ˜í”Œë§ ë‹¨ê³„ê°€ ë¡œë´‡ ì½˜ì†”ë¡œ ì¶œë ¥ë©ë‹ˆë‹¤.</p>
      </div>
      <div class="controls" style="padding-top:0;">
        <div id="log" class="log mono"></div>
      </div>
    </div>
  </div>

  <div class="grid">
    <div class="card c6">
      <h2>ğŸ”¥ HOT (ë§ì´ ë‚˜ì˜¨ TOP 10)</h2>
      <div id="hot" class="chips"></div>
    </div>

    <div class="card c6">
      <h2>ğŸ§Š COLD (ì ê²Œ ë‚˜ì˜¨ TOP 10)</h2>
      <div id="cold" class="chips"></div>
    </div>

    <div class="card c6">
      <h2>â³ OVERDUE (ì˜¤ë˜ ì•ˆ ë‚˜ì˜¨ TOP 10)</h2>
      <div id="overdue" class="chips"></div>
    </div>

    <div class="card c6">
      <h2>ğŸ“Š íŒ¨í„´ ë¶„ì„ (ì—°ì†ë²ˆí˜¸ / êµ¬ê°„)</h2>
      <div id="pattern" class="chips"></div>
    </div>

    <div class="card c6">
      <h2>âš™ï¸ AI ì¶”ì²œ ì¡°í•© (ê°€ì¤‘ì¹˜ ìƒ˜í”Œë§)</h2>
      <div id="reco" class="muted">ë¨¼ì € <b>INITIATE LOTTO CORE</b>ë¡œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.</div>
    </div>

    <div class="card c6">
      <h2>ğŸ§ª ì›ë³¸ ë°ì´í„° ìƒíƒœ</h2>
      <div id="status" class="chips"></div>
    </div>

    <div class="card c6">
      <h2>âœ‰ï¸ ë¬¸ì˜ / í”¼ë“œë°±</h2>
      <form action="https://formspree.io/f/maqddppl" method="POST">
        <div class="formField">
          <label for="formName">ì´ë¦„</label>
          <input id="formName" name="name" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
        </div>
        <div class="formField">
          <label for="formEmail">ì´ë©”ì¼</label>
          <input id="formEmail" name="email" type="email" placeholder="ë‹µë³€ ë°›ì„ ì´ë©”ì¼" required>
        </div>
        <div class="formField">
          <label for="formMessage">ë©”ì‹œì§€</label>
          <textarea id="formMessage" name="message" placeholder="ë¬¸ì˜ ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”" required></textarea>
        </div>
        <button class="formBtn" type="submit">ì „ì†¡í•˜ê¸°</button>
      </form>
    </div>

    <div class="card c6">
      <h2>ğŸ’¬ ëŒ“ê¸€ ë‚¨ê¸°ê¸°</h2>
      <form id="commentForm" action="https://formspree.io/f/maqddppl" method="POST">
        <div class="formField">
          <label for="commentName">ë‹‰ë„¤ì„</label>
          <input id="commentName" name="comment_name" type="text" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
        </div>
        <div class="formField">
          <label for="commentBody">ëŒ“ê¸€</label>
          <textarea id="commentBody" name="comment_body" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
        </div>
        <button class="formBtn" type="submit">ëŒ“ê¸€ ì „ì†¡</button>
      </form>
      <div class="muted" style="margin-top:8px;">ì‘ì„±í•œ ëŒ“ê¸€ì€ ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</div>
      <div id="commentList" class="commentList"></div>
    </div>
  </div>
</div>

<!-- HUD -->
<div id="hud" class="hud hidden" aria-hidden="true">
  <div class="hudBg"></div>
  <div class="hudFrame" id="hudFrame">
    <div class="hudTop">
      <div class="hudTitle">
        <span class="dot"></span>
        <span class="mono">LOTTO COMPUTE SEQUENCE</span>
      </div>
      <button class="hudClose" id="hudClose">âœ•</button>
    </div>

    <div class="hudBody">
      <div class="hudLeft">
        <div class="robot">
          <div class="antenna"></div>
          <div class="head">
            <div class="visor"><div class="scanline"></div></div>
            <div class="eyes"><span></span><span></span><span></span></div>
          </div>
          <div class="neck"></div>
          <div class="torso">
            <div class="core"></div>
            <div class="bars"><i></i><i></i><i></i><i></i><i></i></div>
          </div>
          <div class="arms">
            <div class="arm left"><b></b><b></b><b></b></div>
            <div class="arm right"><b></b><b></b><b></b></div>
          </div>
        </div>

        <div class="hudMeter">
          <div class="meterLabel mono">
            <span>PROCESS</span>
            <span id="hudPct">0%</span>
          </div>
          <div class="meterTrack"><div id="hudBar" class="meterBar"></div></div>
          <div class="meterSub mono" id="hudStep">BOOTINGâ€¦</div>
        </div>
      </div>

      <div class="hudRight">
        <div class="hudConsole mono" id="hudConsole"></div>
        <div class="hudMini">
          <div class="miniCard">
            <div class="miniTitle mono">SIGNAL</div>
            <div class="miniValue" id="sig">â€”</div>
          </div>
          <div class="miniCard">
            <div class="miniTitle mono">SEED</div>
            <div class="miniValue" id="seed">â€”</div>
          </div>
          <div class="miniCard">
            <div class="miniTitle mono">MODE</div>
            <div class="miniValue">WEIGHTED</div>
          </div>
        </div>
      </div>
    </div>

    <div class="hudBottom mono">
      <span class="glow">SCANNING PROBABILITY FIELDâ€¦</span>
      <span id="hudHint">ì—ë„ˆì§€ë¥¼ ì‘ì¶• ì¤‘â€¦</span>
    </div>
  </div>
</div>

<script>
(() => {
  // ===== Config =====
  // ë™í–‰ë³µê¶Œ JSON endpoint (proxyê°€ ëŒ€ì‹  í˜¸ì¶œ)
  // https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo=íšŒì°¨
  const ROBOT = "LottoMind-AI";
  const HISTORY_SIZE = 200;
  const API_BASE = "https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo=";
  const CORS_PROXY = "https://api.allorigins.win/raw?url=";
  const START_DATE = new Date("2002-12-07T20:35:00+09:00");
  const WEEK_MS = 7 * 24 * 60 * 60 * 1000;
  const $ = (id) => document.getElementById(id);

  const logEl = $("log");
  const hotEl = $("hot");
  const coldEl = $("cold");
  const overdueEl = $("overdue");
  const patternEl = $("pattern");
  const recoEl = $("reco");
  const statusEl = $("status");
  const kpiRow = $("kpiRow");
  const commentForm = $("commentForm");
  const commentList = $("commentList");

  const btnGenerate = $("btnGenerate");
  const lineCountEl = $("lineCount");
  const themeToggle = $("themeToggle");

  // HUD
  const hud = $("hud");
  const hudClose = $("hudClose");
  const hudBar = $("hudBar");
  const hudPct = $("hudPct");
  const hudStep = $("hudStep");
  const hudConsole = $("hudConsole");
  const sigEl = $("sig");
  const seedEl = $("seed");
  const hudFrame = $("hudFrame");

  let dataCache = [];       // [{round, nums}]
  let weightsCache = null;  // 1..45 weights
  let useProxy = false;
  let dataSourceLabel = "DHLottery API";

  // ===== Theme =====
  const themeKey = "lottoTheme";
  const commentKey = "lottoComments";
  function applyTheme(theme){
    const next = theme === "light" ? "light" : "dark";
    document.documentElement.setAttribute("data-theme", next);
    themeToggle.textContent = next === "light" ? "ë‹¤í¬ ëª¨ë“œ" : "í™”ì´íŠ¸ ëª¨ë“œ";
    themeToggle.setAttribute("aria-pressed", next === "light");
    localStorage.setItem(themeKey, next);
  }
  function initTheme(){
    const saved = localStorage.getItem(themeKey);
    const prefersLight = window.matchMedia && window.matchMedia("(prefers-color-scheme: light)");
    const initial = saved || (prefersLight && prefersLight.matches ? "light" : "dark");
    applyTheme(initial);
  }
  function loadComments(){
    try {
      const raw = localStorage.getItem(commentKey);
      const arr = JSON.parse(raw || "[]");
      return Array.isArray(arr) ? arr : [];
    } catch {
      return [];
    }
  }
  function saveComments(arr){
    const trimmed = arr.slice(-200);
    localStorage.setItem(commentKey, JSON.stringify(trimmed));
  }
  function renderComments(){
    if (!commentList) return;
    const items = loadComments();
    commentList.innerHTML = "";
    if (!items.length){
      const empty = document.createElement("div");
      empty.className = "muted";
      empty.textContent = "ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.";
      commentList.appendChild(empty);
      return;
    }
    items.slice().reverse().forEach((it) => {
      const wrap = document.createElement("div");
      wrap.className = "commentItem";

      const meta = document.createElement("div");
      meta.className = "commentMeta";
      const name = document.createElement("span");
      name.textContent = it.name || "ìµëª…";
      const time = document.createElement("span");
      const d = new Date(it.ts);
      time.textContent = isNaN(d.getTime()) ? "" : d.toLocaleString();
      meta.append(name, time);

      const body = document.createElement("div");
      body.className = "commentBody";
      body.textContent = it.body || "";

      wrap.append(meta, body);
      commentList.appendChild(wrap);
    });
  }

  // ===== Utilities =====
  const robot = (msg) => {
    const t = new Date().toLocaleTimeString();
    logEl.textContent += `[${ROBOT} ${t}] ${msg}\n`;
    logEl.scrollTop = logEl.scrollHeight;
  };

  const chip = (title, value) => {
    const div = document.createElement("div");
    div.className = "chip";
    div.innerHTML = `<b>${title}</b> <span class="muted">${value}</span>`;
    return div;
  };

  const balls = (nums) => {
    const wrap = document.createElement("div");
    wrap.className = "nums";
    nums.forEach(n => {
      const b = document.createElement("div");
      b.className = "ball";
      b.textContent = n;
      wrap.appendChild(b);
    });
    return wrap;
  };

  const sleep = (ms) => new Promise(r => setTimeout(r, ms));

  function clearUI(full=true){
    hotEl.innerHTML = "";
    coldEl.innerHTML = "";
    overdueEl.innerHTML = "";
    patternEl.innerHTML = "";
    statusEl.innerHTML = "";
    kpiRow.innerHTML = "";
    if (full) {
      recoEl.innerHTML = `<div class="muted">ë¨¼ì € <b>INITIATE LOTTO CORE</b>ë¡œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.</div>`;
      logEl.textContent = "";
    }
  }

  // ===== Button sparks (energy burst) =====
  function spawnSparks(btn, count=18){
    const rect = btn.getBoundingClientRect();
    for (let i=0;i<count;i++){
      const s = document.createElement("div");
      s.className = "spark";
      const x = Math.random() * rect.width;
      const y = Math.random() * rect.height;
      const dx = (Math.random() - 0.5) * 240;
      const dy = (Math.random() - 0.5) * 200;
      s.style.left = x + "px";
      s.style.top = y + "px";
      s.style.setProperty("--dx", dx + "px");
      s.style.setProperty("--dy", dy + "px");
      btn.appendChild(s);
      setTimeout(()=>s.remove(), 800);
    }
  }

  // ===== Background FX (stars/particles) =====
  const canvas = $("bgFx");
  const ctx = canvas.getContext("2d");
  let W=0,H=0, stars=[];
  function resize(){
    W = canvas.width = Math.floor(window.innerWidth * devicePixelRatio);
    H = canvas.height = Math.floor(window.innerHeight * devicePixelRatio);
    canvas.style.width = window.innerWidth + "px";
    canvas.style.height = window.innerHeight + "px";
    stars = Array.from({length: 140}, () => ({
      x: Math.random()*W,
      y: Math.random()*H,
      z: 0.4 + Math.random()*1.2,
      r: (0.8 + Math.random()*1.6) * devicePixelRatio
    }));
  }
  window.addEventListener("resize", resize);
  resize();
  function drawBg(){
    ctx.clearRect(0,0,W,H);
    // soft fog
    const g = ctx.createRadialGradient(W*0.2,H*0.1, 0, W*0.2,H*0.1, Math.max(W,H)*0.7);
    g.addColorStop(0, "rgba(70,243,255,0.08)");
    g.addColorStop(1, "rgba(0,0,0,0)");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    for (const s of stars){
      s.x -= 0.10 * s.z * devicePixelRatio;
      if (s.x < -20) s.x = W + 20, s.y = Math.random()*H;
      ctx.beginPath();
      ctx.fillStyle = `rgba(210,230,255,${0.25 + 0.35*(s.z/1.6)})`;
      ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
      ctx.fill();
    }
    requestAnimationFrame(drawBg);
  }
  drawBg();

  // ===== Live data (via server proxy) =====
  async function fetchDraw(drawNo){
    if (!useProxy){
      try {
        const res = await fetch(`/api/lotto?drawNo=${encodeURIComponent(drawNo)}`, { cache: "no-store" });
        if (!res.ok){
          let msg = "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜";
          try {
            const err = await res.json();
            if (err && err.error) msg = err.error;
          } catch {}
          throw new Error(msg);
        }
        const ct = res.headers.get("content-type") || "";
        if (!ct.includes("application/json")){
          throw new Error("API ì‘ë‹µì´ JSONì´ ì•„ë‹™ë‹ˆë‹¤.");
        }
        const data = await res.json();
        if (data && data.error) throw new Error(data.error);
        if (data && data.returnValue && data.returnValue !== "success") throw new Error("ì¡°íšŒ ì‹¤íŒ¨");
        dataSourceLabel = "DHLottery API (Pages)";
        return data;
      } catch {
        useProxy = true;
        dataSourceLabel = "DHLottery API (proxy)";
      }
    }
    return await fetchDrawViaProxy(drawNo);
  }

  async function fetchDrawViaProxy(drawNo){
    let target = drawNo;
    if (drawNo === "latest"){
      target = await findLatestDrawNoProxy();
    }
    const url = `${API_BASE}${target}`;
    const res = await fetch(`${CORS_PROXY}${encodeURIComponent(url)}`, { cache: "no-store" });
    if (!res.ok) throw new Error("í”„ë¡ì‹œ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜");
    const data = await res.json();
    if (data && data.error) throw new Error(data.error);
    if (data && data.returnValue && data.returnValue !== "success") throw new Error("ì¡°íšŒ ì‹¤íŒ¨");
    return data;
  }

  async function fetchDrawSafeViaProxy(drawNo){
    try {
      const url = `${API_BASE}${drawNo}`;
      const res = await fetch(`${CORS_PROXY}${encodeURIComponent(url)}`, { cache: "no-store" });
      if (!res.ok) return null;
      const data = await res.json();
      return data && data.returnValue === "success" ? data : null;
    } catch {
      return null;
    }
  }

  async function findLatestDrawNoProxy(){
    const estimate = Math.floor((Date.now() - START_DATE.getTime()) / WEEK_MS) + 1;
    let low = Math.max(1, estimate - 8);
    let high = estimate + 8;

    for (let i = 0; i < 12; i += 1) {
      const result = await fetchDrawSafeViaProxy(low);
      if (result) break;
      low = Math.max(1, low - 1);
    }

    for (let i = 0; i < 12; i += 1) {
      const result = await fetchDrawSafeViaProxy(high);
      if (!result) break;
      high += 2;
    }

    let left = low;
    let right = high;
    for (let i = 0; i < 24; i += 1) {
      if (left + 1 >= right) break;
      const mid = Math.floor((left + right) / 2);
      const result = await fetchDrawSafeViaProxy(mid);
      if (result) left = mid;
      else right = mid;
    }
    return left;
  }

  function drawToRecord(data){
    const nums = [data.drwtNo1, data.drwtNo2, data.drwtNo3, data.drwtNo4, data.drwtNo5, data.drwtNo6]
      .map(Number)
      .filter(Number.isFinite)
      .sort((a,b)=>a-b);
    return { round: Number(data.drwNo), nums };
  }

  async function mapLimit(items, limit, fn){
    const results = new Array(items.length);
    let idx = 0;
    const workers = Array.from({length: limit}, async () => {
      while (true){
        const i = idx++;
        if (i >= items.length) break;
        results[i] = await fn(items[i], i);
      }
    });
    await Promise.all(workers);
    return results;
  }

  async function fetchRecentData(latest, count){
    const end = Math.max(1, Number(latest));
    const start = Math.max(1, end - count + 1);
    const rounds = [];
    for (let n=start; n<=end; n++) rounds.push(n);
    const rows = await mapLimit(rounds, 6, async (n) => {
      const data = await fetchDraw(n);
      return drawToRecord(data);
    });
    rows.sort((a,b)=>a.round-b.round);
    return rows;
  }

  // ===== Analysis =====
  function freqAnalysis(data){
    const freq = Array(46).fill(0);
    for (const d of data) for (const n of d.nums) freq[n] += 1;
    return freq;
  }
  function overdueAnalysis(data){
    const latest = data[data.length-1]?.round ?? 0;
    const lastSeen = Array(46).fill(null);
    for (const d of data) for (const n of d.nums) lastSeen[n] = d.round;
    const overdue = Array(46).fill(0);
    for (let n=1;n<=45;n++){
      overdue[n] = (lastSeen[n]==null) ? Infinity : (latest - lastSeen[n]);
    }
    return { overdue, latest };
  }
  function minmaxNormalize(arr, start=1, end=45){
    let mn=Infinity, mx=-Infinity;
    for (let i=start;i<=end;i++){
      if (!Number.isFinite(arr[i])) continue;
      mn=Math.min(mn,arr[i]); mx=Math.max(mx,arr[i]);
    }
    const out=Array(arr.length).fill(0);
    for (let i=start;i<=end;i++){
      if (!Number.isFinite(arr[i])) { out[i]=0; continue; }
      out[i]=(arr[i]-mn)/((mx-mn)+1e-9);
    }
    return out;
  }
  function buildWeights(freq, overdue, wFreq=0.55, wOver=0.45){
    const f=minmaxNormalize(freq);
    const o=minmaxNormalize(overdue);
    const w=Array(46).fill(0);
    for (let n=1;n<=45;n++){
      w[n]=wFreq*f[n]+wOver*o[n];
      w[n]=Math.max(w[n], 0.02);
    }
    return w;
  }
  function weightedSampleUnique(weights, k=6){
    const chosen=new Set();
    while (chosen.size<k){
      let sum=0;
      for (let i=1;i<=45;i++) sum += (chosen.has(i)?0:weights[i]);
      let r=Math.random()*sum;
      let pick=1;
      for (let i=1;i<=45;i++){
        if (chosen.has(i)) continue;
        r -= weights[i];
        if (r<=0){ pick=i; break; }
      }
      chosen.add(pick);
    }
    return Array.from(chosen).sort((a,b)=>a-b);
  }

  // Pattern analysis (ì—°ì†/êµ¬ê°„)
  function consecutiveInfo(numsSorted){
    let streaks=[],cur=1;
    for (let i=1;i<numsSorted.length;i++){
      if (numsSorted[i]===numsSorted[i-1]+1) cur++;
      else { streaks.push(cur); cur=1; }
    }
    streaks.push(cur);
    const longest=Math.max(...streaks);
    const hasConsecutive=streaks.some(s=>s>=2);
    const groups=streaks.filter(s=>s>=2).length;
    return {hasConsecutive,longest,groups};
  }
  function rangeBucket(n){
    if (n<=10) return "1-10";
    if (n<=20) return "11-20";
    if (n<=30) return "21-30";
    if (n<=40) return "31-40";
    return "41-45";
  }
  function patternAnalysis(data){
    let drawsWithConsecutive=0;
    const longestStreakDist={};
    let maxLongest=1;
    const bucketCount={"1-10":0,"11-20":0,"21-30":0,"31-40":0,"41-45":0};
    const perDrawBucketPattern=new Map();

    for (const d of data){
      const nums=[...d.nums].sort((a,b)=>a-b);
      const ci=consecutiveInfo(nums);
      if (ci.hasConsecutive) drawsWithConsecutive++;
      maxLongest=Math.max(maxLongest,ci.longest);
      longestStreakDist[ci.longest]=(longestStreakDist[ci.longest]||0)+1;

      const buckets={"1-10":0,"11-20":0,"21-30":0,"31-40":0,"41-45":0};
      for (const n of nums){
        const b=rangeBucket(n);
        bucketCount[b]+=1;
        buckets[b]+=1;
      }
      const pattern = Object.values(buckets).filter(v=>v>0).sort((a,b)=>b-a).join("-");
      perDrawBucketPattern.set(pattern, (perDrawBucketPattern.get(pattern)||0)+1);
    }

    const totalDraws=data.length;
    const consecutiveRate=(drawsWithConsecutive/totalDraws)*100;
    const topBucketPatterns=[...perDrawBucketPattern.entries()]
      .sort((a,b)=>b[1]-a[1]).slice(0,5)
      .map(([pattern,count])=>({pattern,count}));

    return {totalDraws,drawsWithConsecutive,consecutiveRate,longestStreakDist,maxLongest,bucketCount,topBucketPatterns};
  }

  // ===== Render =====
  function renderAll(){
    hotEl.innerHTML=""; coldEl.innerHTML=""; overdueEl.innerHTML=""; patternEl.innerHTML=""; statusEl.innerHTML=""; kpiRow.innerHTML="";
    const data = dataCache;
    if (!data.length){
      recoEl.innerHTML = `<div class="muted">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ìˆ˜ì§‘ì„ ì‹¤í–‰í•˜ì„¸ìš”.</div>`;
      return;
    }

    // KPIs
    const first=data[0].round, last=data[data.length-1].round;
    const k1=document.createElement("div"); k1.className="kpi"; k1.innerHTML=`<span class="miniDot"></span><b>ìµœì‹  íšŒì°¨</b> <span class="muted">${last}</span>`;
    kpiRow.append(k1);

    // Analysis
    const freq=freqAnalysis(data);
    const {overdue, latest}=overdueAnalysis(data);
    weightsCache = buildWeights(freq, overdue, 0.55, 0.45);

    // HOT/COLD
    const pairs=[];
    for (let n=1;n<=45;n++) pairs.push([n,freq[n]]);
    pairs.sort((a,b)=>b[1]-a[1]);
    pairs.slice(0,10).forEach(([n,c])=>hotEl.appendChild(chip(n, `${c}íšŒ`)));
    pairs.slice().sort((a,b)=>a[1]-b[1]).slice(0,10).forEach(([n,c])=>coldEl.appendChild(chip(n, `${c}íšŒ`)));

    // Overdue
    const od=[];
    for (let n=1;n<=45;n++) if (Number.isFinite(overdue[n])) od.push([n,overdue[n]]);
    od.sort((a,b)=>b[1]-a[1]);
    od.slice(0,10).forEach(([n,d])=>overdueEl.appendChild(chip(n, `${d}íšŒ ë¯¸ì¶œí˜„`)));

    // Pattern
    const pat=patternAnalysis(data);
    patternEl.appendChild(chip("ì—°ì† ì¶œí˜„", `${pat.drawsWithConsecutive}/${pat.totalDraws} (${pat.consecutiveRate.toFixed(1)}%)`));
    patternEl.appendChild(chip("ìµœëŒ€ ì—°ì†", `${pat.maxLongest}ì—°ì†`));
    Object.entries(pat.longestStreakDist).sort((a,b)=>Number(b[0])-Number(a[0])).slice(0,3)
      .forEach(([len,cnt])=>patternEl.appendChild(chip(`ìµœì¥ ${len}ì—°ì†`, `${cnt}íšŒ`)));

    const totalNums=pat.totalDraws*6;
    Object.entries(pat.bucketCount)
      .map(([b,c])=>({b,c,p:(c/totalNums)*100}))
      .sort((a,b)=>b.c-a.c)
      .forEach(x=>patternEl.appendChild(chip(`êµ¬ê°„ ${x.b}`, `${x.c}ê°œ (${x.p.toFixed(1)}%)`)));
    pat.topBucketPatterns.forEach(x=>patternEl.appendChild(chip(`íŒ¨í„´ ${x.pattern}`, `${x.count}íšŒ`)));

    // Status
    statusEl.appendChild(chip("ìµœì‹  íšŒì°¨", latest));
    statusEl.appendChild(chip("ê°€ì¤‘ì¹˜", "READY"));
    statusEl.appendChild(chip("ë°ì´í„° ì†ŒìŠ¤", dataSourceLabel));

    recoEl.innerHTML = `<div class="muted">ì¤€ë¹„ ì™„ë£Œ. <b>RELEASE ENERGY BURST</b>ë¥¼ ëˆ„ë¥´ë©´ ë¡œë´‡ì´ ê³„ì‚°í•©ë‹ˆë‹¤.</div>`;
    btnGenerate.disabled = false;
  }

  function renderRecommendations(lines){
    recoEl.innerHTML = "";
    for (let i=1;i<=lines;i++){
      const pick=weightedSampleUnique(weightsCache, 6);
      const box=document.createElement("div");
      box.style.marginBottom="10px";
      box.style.borderRadius="18px";
      box.style.border="1px solid rgba(255,255,255,0.10)";
      box.style.background="rgba(255,255,255,0.03)";
      box.style.padding="12px";
      box.innerHTML = `<div class="mono muted">SET ${i} :: AI-Weighted Sampling</div>`;
      box.appendChild(balls(pick));
      recoEl.appendChild(box);
    }
  }

  // ===== HUD =====
  function hudOpen(){
    hud.classList.remove("hidden");
    hud.setAttribute("aria-hidden","false");
    hudBar.style.width="0%";
    hudPct.textContent="0%";
    hudStep.textContent="BOOTINGâ€¦";
    hudConsole.textContent="";
  }
  function hudCloseNow(){
    hud.classList.add("hidden");
    hud.setAttribute("aria-hidden","true");
  }
  function hudLog(line){
    hudConsole.textContent += line + "\n";
    hudConsole.scrollTop = hudConsole.scrollHeight;
  }
  hudClose.addEventListener("click", hudCloseNow);
  hud.addEventListener("click", (e)=>{
    if (e.target === hud || e.target.classList.contains("hudBg")) hudCloseNow();
  });

  async function runRobotCompute(lines){
    if (!weightsCache){
      robot("ê°€ì¤‘ì¹˜ ì—†ìŒ. ë¨¼ì € ìˆ˜ì§‘/ë¶„ì„ì„ ì‹¤í–‰í•˜ì„¸ìš”.");
      return;
    }
    const seed = Math.floor(Math.random()*1e9);
    const sig = (Math.random()*100).toFixed(2)+"%";
    seedEl.textContent=seed;
    sigEl.textContent=sig;

    hudOpen();
    hudFrame.classList.add("shake");
    setTimeout(()=>hudFrame.classList.remove("shake"), 520);

    hudLog(`[${ROBOT}] CORE ONLINE`);
    await sleep(220);

    const steps=[
      ["Locking latest draw index", 14],
      ["Normalizing frequency vectors", 30],
      ["Scanning overdue field", 46],
      ["Synthesizing weight map", 62],
      ["Monte-Carlo sampling", 80],
      ["Compressing ticket payload", 94],
      ["ENERGY RELEASE", 100],
    ];

    for (const [label,pct] of steps){
      hudStep.textContent = label + "â€¦";
      hudLog(`[${ROBOT}] ${label} âœ“`);
      const cur = Number(hudPct.textContent.replace("%","")) || 0;
      for (let p=cur; p<=pct; p+=2){
        hudBar.style.width = p+"%";
        hudPct.textContent = p+"%";
        await sleep(14);
      }
      await sleep(140);
    }

    renderRecommendations(lines);
    hudStep.textContent = "RESULT TRANSFERâ€¦";
    hudLog(`[${ROBOT}] Ticket lines delivered.`);
    await sleep(360);
    hudCloseNow();
  }

  async function prepareAnalysis(){
    clearUI(true);
    btnGenerate.disabled = true;
    robot("AI ì½”ì–´ ë¶€íŒ…â€¦");
    try {
      const latestData = await fetchDraw("latest");
      const latest = Number(latestData.drwNo);
      const count = Math.min(HISTORY_SIZE, latest);
      const start = Math.max(1, latest - count + 1);
      robot(`ìµœì‹  íšŒì°¨ í™•ì¸: ${latest}íšŒ`);
      robot(`${start}~${latest}íšŒ ë°ì´í„° ìˆ˜ì§‘ ì¤‘â€¦`);
      dataCache = await fetchRecentData(latest, count);
      robot("ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ.");
      renderAll();
    } catch (err){
      const msg = err && err.message ? err.message : String(err);
      robot(`ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨: ${msg}`);
      recoEl.innerHTML = `<div class="muted">ì‹¤ì œ ë¡œë˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>`;
    } finally {
      btnGenerate.disabled = false;
    }
  }

  // ===== Events =====
  btnGenerate.addEventListener("click", async ()=>{
    spawnSparks(btnGenerate, 28);
    const lines = Math.min(5, Math.max(1, Number(lineCountEl.value || 5)));
    await prepareAnalysis();
    await runRobotCompute(lines);
  });
  themeToggle.addEventListener("click", ()=>{
    const cur = document.documentElement.getAttribute("data-theme");
    applyTheme(cur === "light" ? "dark" : "light");
  });
  if (commentForm){
    commentForm.addEventListener("submit", async (e)=>{
      e.preventDefault();
      const name = $("commentName")?.value?.trim() || "ìµëª…";
      const body = $("commentBody")?.value?.trim();
      if (!body) return;
      const entry = { name, body, ts: new Date().toISOString() };
      const items = loadComments();
      items.push(entry);
      saveComments(items);
      renderComments();
      commentForm.reset();

      const fd = new FormData(commentForm);
      fd.append("comment_ts", entry.ts);
      try {
        await fetch(commentForm.action, { method: "POST", body: fd, headers: { "Accept": "application/json" } });
      } catch {}
    });
  }

  // ===== Init message =====
  initTheme();
  clearUI(true);
  robot("ëŒ€ê¸° ì¤‘â€¦ 1) RUN AI ANALYSIS í´ë¦­");
  renderComments();
})();
</script>
</body>
</html>
